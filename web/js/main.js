document.writeln("<h1 class='logo'align='center'>Book Mall</h1><div class='container'><div class='cart'align='center'><div class='tip'></div><div class='mycart'></div></div><div class='search'align='center'>Price <input id='from'type='number'> - <input id='to'type='number'> <button class='searchbtn'>查找</button></div><div class='books'align='center'></div><div class='page'align='center'><div class='select'></div><div class='page_total'></div></div><div class='cover'align='center'></div></div>");var pageNo=1;var pageSize=7;var pageTotal;var isLast;var isSearch=false;var bookStorge;var cartStorge;$(document).ready(function(){getCart();getPageList();$(".searchbtn").click(function(){getSearchPageList()});$(".cover").hide();$(".container").append('<button class="billsbtn" onclick="getBillsInfo();">我的账单</button>')});function getBillsInfo(){$.ajax({type:"GET",url:"getBills",success:function(b){if(b.code===1){$(".cover").empty();var a=$('<div class="bill_user">用户: '+b.data.user+"</div>");$(".cover").append(a);var d=$('<div class="bill"></div>');$.each(b.data.trade,function(f,h){var j=$('<div class="trade"></div>');var g=$('<div class="bill_time">交易时间: '+getLocalTime(h.trade_time,1)+"</div>");var i=$('<div class="trade_body"></div>');var e=$('<div><div class="headName">书名</div><div class="Price">单价</div><div class="headNum">数量</div></div>');i.append(e);$.each(h.collection,function(k,l){i.append('<div><div class="itemName">'+l.title+'</div><div class="Price"> ¥ '+l.price+'</div><div class="itemNum">'+l.quantity+"</div></div>")});j.append(g);j.append(i);d.append(j)});var c=$('<div class="footer"><button onclick="$(\'.cover\').hide();">返回</button></div>');$(".cover").append(d);$(".cover").append(c);$(".cover").show()}},dataType:"json"})}function procCart(a,b){if(a.code===1){cartStorge=a.data;$(".tip").empty();$(".tip").append(a.errMsg);$(".mycart").empty();$(".mycart").append("您的购物车中有"+a.data.num+'件商品 <button class="checkCart" onclick="getCartInfo();">查看购物车</button> ');if(b===1){getCartInfo()}else{if(b===2){$(".total").empty();$(".total").append("您的购物车中有"+a.data.num+"件商品")}}}}function getCart(){$.ajax({type:"GET",url:"getCart",success:function(a){procCart(a,0)},dataType:"json"})}function addToCart(b,a){$.ajax({type:"GET",url:"addBooksToCart?id="+b+"&quantity="+a,success:function(c){procCart(c,2)},dataType:"json"})}function setCart(b,a){$.ajax({type:"GET",url:"setCart?id="+b+"&quantity="+a,success:function(c){procCart(c,1)},dataType:"json"})}function clearCart(){$.ajax({type:"GET",url:"clearCart",success:function(a){procCart(a,1)},dataType:"json"})}function getCartInfo(){$(".cover").empty();var b=$('<div class="cart_detail"></div>');var c=$('<div class="total">您的购物车中有'+cartStorge.num+"件商品</div>");var e=$('<div class="cart_header"><div class="headName">书名</div><div class="headNum">数量</div><div class="headPrice">价格</div></div>');var a=$('<div class="cart_body"></div>');var d=$('<div class="footer"><div style="margin-top: 10px;margin-bottom: 10px">总金额: ¥'+cartStorge.total+'</div><button onclick="clearCart();">清空购物车</button> <button onclick="getPay();">结账</button> <button onclick="$(\'.cover\').hide();">返回</button></div>');$.each(cartStorge.queryList,function(g,h){var f=$('<div class="cartItem"></div>');f.append('<div class="itemName">'+h.book.title+'</div><div class="itemNum"><input onchange="setCart('+h.book.id+',this.value);" type="number" value="'+h.quantity+'"></div><div class="itemPrice">¥ '+h.totalMoney+' <button class="del" onclick="setCart('+h.book.id+',0);">删除</button></div>');a.append(f)});b.append(c);b.append(e);b.append(a);b.append(d);$(".cover").append(b);$(".cover").show()}function pay(){$.ajax({type:"POST",url:"pay",data:{name:$(".pay_userName input").val(),cardId:$(".pay_cardId input").val()},success:function(c){if(c.code===-1){$(".pay_error").empty();$(".pay_error").append(c.errMsg)}else{if(c.code===1){$(".cover").empty();var h=$('<div class="trade"></div>');var d=$('<div class="trade_title"><h1>账单</h1></div>');var g=$('<div class="trade_user">用户: '+c.data.user+"</div>");var b=$('<div class="trade_time">交易时间: '+getLocalTime(c.data.trade_time,1)+'</div><div class="trade_money">总计 ¥ '+c.data.trade_total+"</div>");var e=$('<div class="trade_body"></div>');var a=$('<div><div class="headName">书名</div><div class="Price">单价</div><div class="headNum">数量</div></div>');e.append(a);$.each(c.data.queryList,function(i,j){e.append('<div><div class="itemName">'+j.book.title+'</div><div class="Price"> ¥ '+j.book.price+'</div><div class="itemNum">'+j.quantity+"</div></div>")});var f=$('<div class="footer"><button onclick="$(\'.cover\').hide();getCart();">返回</button></div>');h.append(d);h.append(g);h.append(b);h.append(e);h.append(f);$(".cover").append(h);$(".cover").show()}}},dataType:"json"})}function getPay(){$(".cover").empty();var h=$('<div class="pay"></div>');var b=$('<div class="pay_title"><h1>收银台</h1></div>');var g=$('<div class="pay_detail">购物车中总计 '+cartStorge.num+" 本书</div>");var f=$('<div class="pay_detail">应付 ¥ '+cartStorge.total+"</div>");var e=$('<div class="pay_error"></div>');var a=$('<div class="pay_userName">信用卡姓名: <input type="text"></div>');var c=$('<div class="pay_cardId">信用卡账号: <input type="text"></div>');var d=$('<div class="footer"><button onclick="pay();">确认</button> <button onclick="$(\'.cover\').hide();">返回</button></div>');h.append(b);h.append(g);h.append(f);h.append(e);h.append(a);h.append(c);h.append(d);$(".cover").append(h);$(".cover").show()}function Page(a){pageNo=a;if(isSearch===true){getSearchPageList()}else{getPageList()}}function procPage(a){if(a.code===1){bookStorge=a.data.queryList;pageNo=a.data.pageNo;pageSize=a.data.pageSize;pageTotal=a.data.pageTotal;isLast=a.data.isLast;$(".books").empty();$.each(a.data.queryList,function(b,c){$(".books").append('<div class="book"><div class="vertical" align="left"><div class="title"><a href="#" onclick="getBookInfo('+c.id+');">'+c.title+'</a></div><div class="author">'+c.author+'</div></div><div class="horizon">¥'+c.price+' <button onclick="addToCart('+c.id+', 1)">添加至购物车</button></div></div>')});$(".page_total").empty();$(".page_total").append("共 "+pageTotal+" 页 当前第 "+pageNo+" 页");$(".select").empty();if(pageNo!==1){$(".select").append('<a href="#" onclick="Page(1);">首页</a> <a href="#" onclick="Page(pageNo-1);">上一页</a> ')}if(pageNo!==pageTotal){$(".select").append('<a href="#" onclick="Page(pageNo+1);">下一页</a> <a href="#" onclick="Page(pageTotal);">末页 </a>')}if(pageTotal!==1){$(".page_total").append(' 转到 <input type="number" class="inputPageNo"> 页')}$(".inputPageNo").change(function(){if(this.value<=pageTotal&&this.value>0&&this.value!==pageNo){Page(this.value)}this.value=""})}}function getPageList(){$.ajax({type:"GET",url:"getPage?pageNo="+pageNo+"&pageSize="+pageSize,success:function(a){procPage(a)},dataType:"json"})}function getSearchPageList(){var b=$("#from").val();var a=$("#to").val();if(b===""||b<0||a===""){return}if(isSearch===false){pageNo=1}isSearch=true;$.ajax({type:"GET",url:"getPrice?from="+b+"&to="+a+"&pageNo="+pageNo+"&pageSize="+pageSize,success:function(c){procPage(c)},dataType:"json"})}function getBookInfo(a){$.each(bookStorge,function(b,e){if(e.id===a){var d=$('<div class="total">您的购物车中有'+cartStorge.num+"件商品</div>");$(".tip").empty();$(".cover").empty();var c=$('<div class="book_detail"><div class="detail">书名:'+e.title+'</div><div class="detail">作者:'+e.author+'</div><div class="detail">单价: ¥'+e.price+'</div><div class="detail">出版时间: '+getLocalTime(e.publishing_date,0)+'</div><div class="detail">库存: '+e.store_number+'</div><div class="detail">评论: '+e.remark+'</div><div class="footer"><button onclick="addToCart('+e.id+', 1)">添加至购物车</button> <button onclick="$(\'.cover\').hide()">返回</button></div></div>');$(".cover").append(d);$(".cover").append(c);$(".cover").show()}})}function getLocalTime(a,b){if(b===0){return new Date(parseInt(a)).toLocaleString().replace(/[\u4e00-\u9fa5][\u4e00-\u9fa5]\d{1,2}:\d{1,2}:\d{1,2}$/," ")}else{if(b===1){return new Date(parseInt(a)).toLocaleString()}}};